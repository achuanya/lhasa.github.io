let e=[];function t(t,s,c){const r=document.getElementById("calendar");r.innerHTML="";["一","二","三","四","五","六","日"].forEach((e=>{const t=document.createElement("div");t.className="calendar-week-header",t.innerText=e,r.appendChild(t)}));const l=a().toISOString().split("T")[0];let d=new Date(s);d.setUTCHours(0,0,0,0),e=[];let m=null;function u(t,n){const a=document.createElement("div");a.className="day-container";const i=document.createElement("span");i.className="date-number",i.innerText=t.getUTCDate(),a.appendChild(i);const o=n.find((e=>e.activity_time===t.toISOString().split("T")[0]));o&&e.push(o);const s=o?Math.min(parseFloat(o.riding_distance)/4,24):2,c=document.createElement("div");return c.className="activity-indicator",c.style.width=`${s}px`,c.style.height=`${s}px`,o||c.classList.add("no-activity"),c.style.left="50%",c.style.top="50%",a.appendChild(c),a.addEventListener("mouseenter",(()=>{t.toDateString()===(new Date).toDateString()?(i.style.opacity="0",c.style.opacity="1"):m&&(m.querySelector(".date-number").style.opacity="0",m.querySelector(".activity-indicator").style.opacity="1")})),a.addEventListener("mouseleave",(()=>{t.toDateString()===(new Date).toDateString()?(i.style.opacity="1",c.style.opacity="0"):m&&(m.querySelector(".date-number").style.opacity="1",m.querySelector(".activity-indicator").style.opacity="0")})),t.toDateString()===(new Date).toDateString()&&(m=a,a.classList.add("today"),c.style.backgroundColor="#242428",i.style.color="#242428",i.style.opacity="1",c.style.opacity="0"),a}(async function(){for(let e=0;e<c;e++)for(let n=0;n<7;n++){if(d.toISOString().split("T")[0]>l)return;const e=u(d,t);r.appendChild(e),await new Promise((e=>setTimeout(e,30))),d.setUTCDate(d.getUTCDate()+1)}})().then((()=>{!function(){const t=document.getElementById("barChart");t.innerHTML="";const n=o(a(),21),s={};let c=new Date(n);c.setUTCHours(0,0,0,0);for(let e=0;e<4;e++){const e=new Date(c),t=new Date(e);t.setUTCDate(e.getUTCDate()+6);const n=`${e.toISOString().split("T")[0]} - ${t.toISOString().split("T")[0]}`;s[n]=0,c.setUTCDate(c.getUTCDate()+7)}e.forEach((e=>{const t=function(e){const t=e.getDay(),n=(0===t?-6:1)-t,a=new Date(e);return a.setDate(a.getDate()+n),a}(new Date(e.activity_time)),n=new Date(t);n.setUTCDate(t.getUTCDate()+6);const a=`${t.toISOString().split("T")[0]} - ${n.toISOString().split("T")[0]}`;void 0!==s[a]&&(s[a]+=parseFloat(e.riding_distance))}));const r=Math.max(...Object.values(s),0);Object.keys(s).forEach((e=>{const n=s[e],a=document.createElement("div");a.className="bar-container";const o=document.createElement("div");o.className="bar";const c=r>0?n/r*190:0;o.style.setProperty("--bar-width",`${c}px`);const l=document.createElement("div");l.className="cycling-kilometer",l.innerText="0 km";const d=i(),m=i();a.style.position="relative",o.appendChild(l),a.appendChild(o),a.appendChild(d),a.appendChild(m),t.appendChild(a),o.style.width="0",o.offsetHeight,o.style.transition="width 1s ease-out",o.style.width=`${c}px`,l.style.opacity="1",function(e,t,n,a,i=!1){const o=performance.now();function s(){const t=performance.now()-o,c=Math.min(t/a,1),r=(c*n).toFixed(2);e.innerText=i?`${r} km`:`${r}h`,c<1?requestAnimationFrame(s):e.innerText=i?`${n.toFixed(2)} km`:`${n.toFixed(2)}h`}s()}(l,0,n,1e3,!0),function(e,t,n,a){let i,o;e.addEventListener("mouseenter",(()=>{clearTimeout(i),clearTimeout(o);const e=a>140?"这周干的还不错":"偷懒了啊";t.innerText=e,t.classList.add("show"),o=setTimeout((()=>{t.classList.remove("show")}),700)})),e.addEventListener("mouseleave",(()=>{i=setTimeout((()=>{t.classList.remove("show")}),700)})),e.addEventListener("click",(()=>{n.innerText="一起来运动吧！",n.classList.add("show"),setTimeout((()=>{n.classList.remove("show")}),700),t.classList.remove("show"),clearTimeout(i),clearTimeout(o)}))}(o,d,m,n)}))}(),n()}))}function n(e){const t=document.getElementById("totalCount"),n=document.getElementById("milesRiddenThisYear"),a=document.getElementById("totalTitle");if(!t||!n||!a)return;const i=t.querySelector("#ridingTimeThisYearValue"),o=n.querySelector("#milesRiddenThisYearValue"),c=t.querySelector(".loading-spinner"),r=n.querySelector(".loading-spinner");c.classList.add("active"),r.classList.add("active");const l=(new Date).getFullYear();a.textContent=`${l} 骑行总时长`;const d=e.filter((e=>new Date(e.activity_time).getFullYear()===l)),m=d.reduce(((e,t)=>e+parseFloat(t.moving_time)||0),0),u=function(e){return e.reduce(((e,t)=>e+parseFloat(t.riding_distance)||0),0)}(d);s(i,m,1e3,50,!1),s(o,u,1e3,50,!0),setTimeout((()=>{console.log(u.toFixed(2)),i.textContent=`${m.toFixed(2)} h`,o.textContent=`${u.toFixed(2)} km`,c.classList.remove("active"),r.classList.remove("active")}),1e3)}function a(){return new Date((new Date).getTime()+288e5)}function i(){const e=document.createElement("div");return e.className="message-box",e}function o(e,t){const n=e.getUTCDay(),a=0===n?6:n-1,i=new Date(e);return i.setUTCDate(e.getUTCDate()-a-t),i}function s(e,t,n,a,i=!1){const o=t/(n/a);let s=0;const c=setInterval((()=>{s+=o,s>=t&&(s=t,clearInterval(c)),e.textContent=i?`${s.toFixed(2)} km`:`${s.toFixed(2)} h`}),a);setTimeout((()=>{e.textContent=i?`${t.toFixed(2)} km`:`${t.toFixed(2)} h`}),n)}!async function(){const e=o(a(),21),i=await async function(){return(await fetch("https://cos.lhasa.icu/data/cycling_data.json")).json()}();t(i,e,4),n(i)}();
