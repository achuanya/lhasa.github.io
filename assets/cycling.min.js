let t=[];function e(e,i,c){const r=document.getElementById("calendar");r.innerHTML="";["一","二","三","四","五","六","日"].forEach((t=>{const e=document.createElement("div");e.className="calendar-week-header",e.innerText=t,r.appendChild(e)}));const l=a().toISOString().split("T")[0];let d=new Date(i);d.setUTCHours(0,0,0,0),t=[];let m=null;function u(e,n){const a=document.createElement("div");a.className="day-container";const o=document.createElement("span");o.className="date-number",o.innerText=e.getUTCDate(),a.appendChild(o);const s=n.find((t=>t.start_date_local===e.toISOString().split("T")[0]));s&&t.push(s);const i=s?Math.min(parseFloat(s.distance)/4,24):2,c=document.createElement("div");return c.className="activity-indicator",c.style.width=`${i}px`,c.style.height=`${i}px`,s||c.classList.add("no-activity"),c.style.left="50%",c.style.top="50%",a.appendChild(c),a.addEventListener("mouseenter",(()=>{e.toDateString()===(new Date).toDateString()?(o.style.opacity="0",c.style.opacity="1"):m&&(m.querySelector(".date-number").style.opacity="0",m.querySelector(".activity-indicator").style.opacity="1")})),a.addEventListener("mouseleave",(()=>{e.toDateString()===(new Date).toDateString()?(o.style.opacity="1",c.style.opacity="0"):m&&(m.querySelector(".date-number").style.opacity="1",m.querySelector(".activity-indicator").style.opacity="0")})),e.toDateString()===(new Date).toDateString()&&(m=a,a.classList.add("today"),c.style.backgroundColor="#242428",o.style.color="#242428",o.style.opacity="1",c.style.opacity="0"),a}(async function(){for(let t=0;t<c;t++)for(let n=0;n<7;n++){if(d.toISOString().split("T")[0]>l)return;const t=u(d,e);r.appendChild(t),await new Promise((t=>setTimeout(t,30))),d.setUTCDate(d.getUTCDate()+1)}})().then((()=>{!function(){const e=document.getElementById("barChart");e.innerHTML="";const n=s(a(),21),i={};let c=new Date(n);c.setUTCHours(0,0,0,0);for(let t=0;t<4;t++){const t=new Date(c),e=new Date(t);e.setUTCDate(t.getUTCDate()+6);const n=`${t.toISOString().split("T")[0]} - ${e.toISOString().split("T")[0]}`;i[n]=0,c.setUTCDate(c.getUTCDate()+7)}t.forEach((t=>{const e=function(t){const e=t.getDay(),n=(0===e?-6:1)-e,a=new Date(t);return a.setDate(a.getDate()+n),a}(new Date(t.start_date_local)),n=new Date(e);n.setUTCDate(e.getUTCDate()+6);const a=`${e.toISOString().split("T")[0]} - ${n.toISOString().split("T")[0]}`;void 0!==i[a]&&(i[a]+=parseFloat(t.distance))}));const r=Math.max(...Object.values(i),0);Object.keys(i).forEach((t=>{const n=i[t],a=document.createElement("div");a.className="bar-container";const s=document.createElement("div");s.className="bar";const c=r>0?n/r*190:0;s.style.setProperty("--bar-width",`${c}px`);const l=document.createElement("div");l.className="cycling-kilometer",l.innerText="0 km";const d=o(),m=o();a.style.position="relative",s.appendChild(l),a.appendChild(s),a.appendChild(d),a.appendChild(m),e.appendChild(a),s.style.width="0",s.offsetHeight,s.style.transition="width 1s ease-out",s.style.width=`${c}px`,l.style.opacity="1",function(t,e,n,a,o=!1){const s=performance.now();function i(){const e=performance.now()-s,c=Math.min(e/a,1),r=(c*n).toFixed(2);t.innerText=o?`${r} km`:`${r}h`,c<1?requestAnimationFrame(i):t.innerText=o?`${n.toFixed(2)} km`:`${n.toFixed(2)}h`}i()}(l,0,n,1e3,!0),function(t,e,n,a){let o,s;t.addEventListener("mouseenter",(()=>{clearTimeout(o),clearTimeout(s);const t=a>140?"这周干的还不错":"偷懒了啊";e.innerText=t,e.classList.add("show"),s=setTimeout((()=>{e.classList.remove("show")}),700)})),t.addEventListener("mouseleave",(()=>{o=setTimeout((()=>{e.classList.remove("show")}),700)})),t.addEventListener("click",(()=>{n.innerText="一起来运动吧！",n.classList.add("show"),setTimeout((()=>{n.classList.remove("show")}),700),e.classList.remove("show"),clearTimeout(o),clearTimeout(s)}))}(s,d,m,n)}))}(),n()}))}function n(t){const e=document.getElementById("totalCount"),n=document.getElementById("milesRiddenThisYear"),a=document.getElementById("totalTitle");if(!e||!n||!a)return;const o=e.querySelector("#ridingTimeThisYearValue"),s=n.querySelector("#milesRiddenThisYearValue"),c=e.querySelector(".loading-spinner"),r=n.querySelector(".loading-spinner");c.classList.add("active"),r.classList.add("active");const l=(new Date).getFullYear();a.textContent=`${l} 骑行总时长`;const d=t.filter((t=>new Date(t.start_date_local).getFullYear()===l)),m=d.reduce(((t,e)=>t+parseFloat(e.moving_time)||0),0),u=function(t){return t.reduce(((t,e)=>t+parseFloat(e.distance)||0),0)}(d);i(o,m,1e3,50,!1),i(s,u,1e3,50,!0),setTimeout((()=>{console.log(u.toFixed(2)),o.textContent=`${m.toFixed(2)} h`,s.textContent=`${u.toFixed(2)} km`,c.classList.remove("active"),r.classList.remove("active")}),1e3)}function a(){return new Date((new Date).getTime()+288e5)}function o(){const t=document.createElement("div");return t.className="message-box",t}function s(t,e){const n=t.getUTCDay(),a=0===n?6:n-1,o=new Date(t);return o.setUTCDate(t.getUTCDate()-a-e),o}function i(t,e,n,a,o=!1){const s=e/(n/a);let i=0;const c=setInterval((()=>{i+=s,i>=e&&(i=e,clearInterval(c)),t.textContent=o?`${i.toFixed(2)} km`:`${i.toFixed(2)} h`}),a);setTimeout((()=>{t.textContent=o?`${e.toFixed(2)} km`:`${e.toFixed(2)} h`}),n)}!async function(){const t=s(a(),21),o=await async function(){return(await fetch("https://cos.lhasa.icu/data/strava_data.json")).json()}();e(o,t,4),n(o)}();
